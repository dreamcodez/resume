version: '1.0'
steps:
  build:
    description: ðŸ”¨  Building docker image
    type: build
    dockerfile: Dockerfile
    image_name: dreamcodez/resume
    tag: ${{CF_SHORT_REVISION}}
  push:
    description: ðŸŒŸ  Pushing to quay.io
    type: push
    candidate: ${{build}}
    tag: ${{CF_SHORT_REVISION}}
    registry: quay
  deploy_to_kubernetes:
    description: ðŸš€  Deploying to kubernetes
    image: codefresh/cf-deploy-kubernetes
    working-directory: ${{initial-clone}}
    tag: ${{CF_SHORT_REVISION}}
    commands:
      - 'echo -n $KUBECREDENTIALSB64 | base64 -d | tar -xvz'
      - '/template.sh deployment.yml | kubectl apply -f -'
      #- "kubectl delete pod -l 'app=resume'"
    environment:
      - KUBECONFIG=kubeconfig
